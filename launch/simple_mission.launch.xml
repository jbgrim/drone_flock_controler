<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="world" default="default"/>
  <arg name="k_mig" default="5.0"/>
  <arg name="k_sep" default="10.0"/>
  <arg name="k_coh" default="1.0"/>
  <!-- Start the Gazebo simulation environment -->
  <executable name="simulation" cmd="gz sim -r Tools/simulation/gz/worlds/$(var world).sdf" output="log" cwd="src/PX4-Autopilot">
    <env name="GZ_SIM_RESOURCE_PATH" value="Tools/simulation/gz/models"/>
    <env name="GZ_SIM_SERVER_CONFIG_PATH" value="Tools/simulation/gz/server.config"/>
    <env name="GZ_SIM_SYSTEM_PLUGIN_PATH" value="build/px4_sitl_default/src/modules/simulation/gz_plugins/"/>
  </executable>

  <!-- Start the Micro XRCE Agent for translating ROS2 and uORB topics-->
  <executable name="micro_xrce_agent" cmd="MicroXRCEAgent udp4 -p 8888" output="log"/>
  
  <!-- Start the Ground Control Station (GCS) -->
  <executable name="gcs" cmd="./QGroundControl-x86_64.AppImage" output="log"/>
  <!-- <executable name="mavsdk" cmd="./build/main udpin://0.0.0.0:14550" cwd="../mavlink_drones" output="screen"/> -->

  <!-- Start the ROS2 node that defines circular trajectory -->
  <node pkg="drone_flock_controler" exec="circular_trajectory" name="circular_trajectory" output="screen">
    <param name="radius" value="15.0"/>
    <param name="height" value="-5.0"/>
    <param name="angular_velocity" value="0.5"/>
  </node>

  <!-- Launch multiple instances of drones with their controllers -->
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="0"/>
    <arg name="pose_x" value="0"/>
    <arg name="pose_y" value="0"/>
    <arg name="world" value="$(var world)"/>
    <arg name="k_mig" value="$(var k_mig)"/>
    <arg name="k_sep" value="$(var k_sep)"/>
    <arg name="k_coh" value="$(var k_coh)"/>
  </include> 
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="1"/>
    <arg name="pose_x" value="0"/>
    <arg name="pose_y" value="2"/>
    <arg name="world" value="$(var world)"/>
    <arg name="k_mig" value="$(var k_mig)"/>
    <arg name="k_sep" value="$(var k_sep)"/>
    <arg name="k_coh" value="$(var k_coh)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="2"/>
    <arg name="pose_x" value="2"/>
    <arg name="pose_y" value="0"/>
    <arg name="world" value="$(var world)"/>
    <arg name="k_mig" value="$(var k_mig)"/>
    <arg name="k_sep" value="$(var k_sep)"/>
    <arg name="k_coh" value="$(var k_coh)"/>
  </include>
  <!--<include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="3"/>
    <arg name="pose_x" value="2"/>
    <arg name="pose_y" value="2"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="4"/>
    <arg name="pose_x" value="0"/>
    <arg name="pose_y" value="4"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="5"/>
    <arg name="pose_x" value="0"/>
    <arg name="pose_y" value="6"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
  <!-- <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="6"/>
    <arg name="pose_x" value="2"/>
    <arg name="pose_y" value="4"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
  <!-- <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="7"/>
    <arg name="pose_x" value="2"/>
    <arg name="pose_y" value="6"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="8"/>
    <arg name="pose_x" value="4"/>
    <arg name="pose_y" value="0"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
  <!-- <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="9"/>
    <arg name="pose_x" value="4"/>
    <arg name="pose_y" value="2"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="10"/>
    <arg name="pose_x" value="6"/>
    <arg name="pose_y" value="0"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
  <!-- <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="11"/>
    <arg name="pose_x" value="6"/>
    <arg name="pose_y" value="2"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
  <!-- <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="12"/>
    <arg name="pose_x" value="4"/>
    <arg name="pose_y" value="4"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="13"/>
    <arg name="pose_x" value="4"/>
    <arg name="pose_y" value="6"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="14"/>
    <arg name="pose_x" value="6"/>
    <arg name="pose_y" value="4"/>
    <arg name="world" value="$(var world)"/>
  </include>
  <include file="$(find-pkg-share drone_flock_controler)/launch/launch_single.launch.xml">
    <arg name="instance_id" value="15"/>
    <arg name="pose_x" value="6"/>
    <arg name="pose_y" value="6"/>
    <arg name="world" value="$(var world)"/>
  </include> -->
</launch>
